<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      {% block title %}
      {% endblock %}
    </title>
    <!-- Include Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

<div class="flex h-screen bg-gray-200">

    <!-- Left Sidebar -->
    <div class="w-64 bg-gray-800 text-white p-4">
        <div class="text-2xl font-semibold mb-4">Admin Dashboard</div>

        <!-- Sidebar Menu -->
        <ul class="space-y-2">
            <li class="flex items-center">
                <a href="#" class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <!-- Add your menu icon SVG code here -->
                    </svg>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="flex items-center">
                <a href="#" class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <!-- Add your menu icon SVG code here -->
                    </svg>
                    <span>Users</span>
                </a>
            </li>
            <li class="relative group">
              <a href="{% url 'admin_messages' %}" class="flex items-center space-x-2">
                <svg width="40px" height="40px" viewBox="-2.4 -2.4 28.80 28.80" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#fff" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#fff" stroke-width="0.43200000000000005"></g><g id="SVGRepo_iconCarrier"> <path d="M8 12H8.01M12 12H12.01M16 12H16.01M21.0039 12C21.0039 16.9706 16.9745 21 12.0039 21C9.9675 21 3.00463 21 3.00463 21C3.00463 21 4.56382 17.2561 3.93982 16.0008C3.34076 14.7956 3.00391 13.4372 3.00391 12C3.00391 7.02944 7.03334 3 12.0039 3C16.9745 3 21.0039 7.02944 21.0039 12Z" stroke="#fff" stroke-width="1.248" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                  <span>Messages</span>
              </a>
              <div class="absolute -top-2 -right-2 bg-red-500 text-white px-2 py-1 rounded-full">
                  <!-- Your notification count goes here -->
                  <span id="bellCount" data-count="0">0</span>
              </div>
              <ul class="absolute right-0 mt-2 space-y-2 bg-gray-800 text-white p-2 rounded-md" id="notify">
              </ul>
          </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-4">
        {% block content %}
        {% endblock %}
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

<script>
    // setup chat scoket
    const notifyScoket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/notify/'
    );

    // on socket open
    notifyScoket.onopen = function (e) {
        console.log('Socket successfully connected.');
    };

    // on socket close
    notifyScoket.onclose = function (e) {
        console.log('Socket closed unexpectedly');
    };

    // on receiving message on group
    notifyScoket.onmessage = function (e) {
        console.log('Received message:', e.data);
        const data = JSON.parse(e.data);
        const message = data.message;
        // Call the setMessage function to add the new li element
        setMessage(message);

    };

    function setMessage(message) {
        console.log('Setting message:', message);
        // Create a new li element
        var newLi = document.createElement('li');

        // Create a new anchor element
        var newAnchor = document.createElement('a');
        newAnchor.className = 'block px-4 py-2 text-gray-800 hover:bg-gray-200 whitespace-normal';
        newAnchor.href = '#';
        newAnchor.textContent = message;

        // Append the anchor element to the li element
        newLi.appendChild(newAnchor);

        // Get the ul element with the id "notify"
        var ulElement = document.getElementById('notify');

        // Append the new li element to the ul element
        ulElement.appendChild(newLi);

        // getting object of count
        var countElement = document.getElementById('bellCount');
    var count = parseInt(countElement.getAttribute('data-count')) || 0;

    // Increment the count
    count += 1;

    // Set the new count in the data-count attribute and the visible text content
    countElement.setAttribute('data-count', count);
    countElement.textContent = count;
    }


</script>
</body>
</html>
